# Bun Server Framework - v1.0.0 Roadmap

> 当前版本: 0.4.0\
> 目标版本: 1.0.0

## 🎯 v1.0.0 版本目标

v1.0.0 是框架的第一个稳定版本（Stable
Release），标志着框架已经具备企业级应用所需的核心能力。主要目标包括：

1. **数据库集成**：提供完整的数据库连接、ORM 集成和事务支持
2. **生产就绪**：完善测试覆盖、文档和稳定性
3. **API 稳定性**：确保 API 向后兼容，为后续版本奠定基础
4. **开发者体验**：提供 CLI 工具和更好的开发体验

---

## 📊 v0.3.0 完成情况总结

### ✅ 已完成的核心功能

#### 数据库模块 (95%) ✅ v0.4.0 核心功能已完成

- ✅ **DatabaseModule**（数据库连接管理）
  - ✅ 连接池管理（基于 `bun:sqlite`、`postgres`、`mysql2`）
  - ✅ 多数据库支持（PostgreSQL, MySQL, SQLite）
  - ✅ 连接健康检查
  - ✅ 连接重试机制
  - ✅ 连接池配置（最大连接数、超时时间等）
  - ✅ 集成到 HealthModule（数据库连接健康检查）
  - ✅ 提供示例和文档（`examples/database-app.ts`）

- ✅ **ORM 集成**（Drizzle ORM）
  - ✅ Drizzle ORM 集成
  - ✅ 装饰器支持（@Entity, @Column, @PrimaryKey）
  - ✅ Repository 模式支持（BaseRepository, DrizzleBaseRepository）
  - ✅ 查询构建器集成
  - ✅ 集成到 DI 容器（自动注入 Repository）
  - ⚠️ 关系映射支持（@OneToMany, @ManyToOne, @ManyToMany）- **待实现**

- ✅ **事务支持**
  - ✅ 事务装饰器 `@Transactional()`
  - ✅ 基本事务支持
  - ✅ 嵌套事务支持（保存点）
  - ✅ 事务传播行为（REQUIRED, REQUIRES_NEW, SUPPORTS, NOT_SUPPORTED, NEVER,
    NESTED）
  - ✅ 事务隔离级别（READ_UNCOMMITTED, READ_COMMITTED, REPEATABLE_READ,
    SERIALIZABLE）
  - ✅ 回滚策略配置（rollbackFor, noRollbackFor）

- ✅ **测试覆盖**
  - ✅ DatabaseModule 测试（`tests/database/database-module.test.ts`）
  - ✅ ORM 集成测试（`tests/database/orm.test.ts`）
  - ✅ 事务支持测试（`tests/database/transaction.test.ts`）
  - ⚠️ PostgreSQL/MySQL 集成测试（当前只有 SQLite 测试）- **待补充**

---

#### 核心框架 (100%)

- ✅ Application 应用主类
- ✅ Router 路由系统（静态路由缓存优化）
- ✅ Context 请求上下文封装
- ✅ Server 服务器封装（基于 Bun.serve）

#### 依赖注入系统 (100%)

- ✅ Container DI 容器
- ✅ @Injectable / @Inject 装饰器
- ✅ Module 模块系统（支持 imports/exports）
- ✅ 生命周期管理（Singleton, Transient）
- ✅ 依赖计划缓存优化

#### 中间件系统 (100%)

- ✅ Middleware Pipeline 中间件管道
- ✅ @UseMiddleware 装饰器
- ✅ 内置中间件：
  - ✅ 日志中间件
  - ✅ CORS 中间件
  - ✅ 错误处理中间件
  - ✅ 文件上传中间件
  - ✅ 静态文件服务中间件
  - ✅ **速率限制中间件**（v0.3.0 新增）

#### 控制器系统 (100%)

- ✅ @Controller 装饰器
- ✅ 参数绑定（@Body, @Query, @Param, @Header）
- ✅ 路由装饰器（@GET, @POST, @PUT, @DELETE, @PATCH）
- ✅ ControllerRegistry 控制器注册表

#### 验证系统 (100%)

- ✅ @Validate 验证装饰器
- ✅ 常用验证规则（IsString, IsEmail, MinLength, etc.）
- ✅ ValidationError 异常处理

#### 错误处理 (100%)

- ✅ HttpException 异常基类
- ✅ 常用异常类（BadRequest, Unauthorized, NotFound, etc.）
- ✅ ExceptionFilter 异常过滤器
- ✅ 全局错误处理中间件
- ✅ 错误码系统（error-codes.ts）
- ✅ 错误消息国际化支持（i18n.ts）

#### WebSocket 支持 (100%)

- ✅ @WebSocketGateway 装饰器
- ✅ @OnMessage / @OnOpen / @OnClose 装饰器
- ✅ WebSocketGatewayRegistry 网关注册表

#### 文件处理 (100%)

- ✅ 文件上传中间件
- ✅ 文件下载支持
- ✅ 静态文件服务中间件（路径穿越防护）

#### Swagger/OpenAPI (100%)

- ✅ SwaggerExtension 扩展
- ✅ SwaggerModule 模块
- ✅ API 装饰器（@ApiTags, @ApiOperation, @ApiParam, @ApiBody, @ApiResponse）
- ✅ Swagger UI 集成

#### 安全认证 (100%)

- ✅ SecurityModule 安全模块
- ✅ JWT 认证支持
- ✅ OAuth2 认证支持
- ✅ @Auth() 装饰器（角色权限控制）
- ✅ AuthenticationManager 认证管理器
- ✅ AccessDecisionManager 访问决策管理器
- ✅ SecurityContext 线程安全（使用 AsyncLocalStorage）

#### 官方模块 (100%)

- ✅ **ConfigModule**（配置管理）- v0.2.1 完成
  - ✅ 环境变量支持（.env 文件）
  - ✅ 配置验证
  - ✅ 配置合并和优先级
  - ✅ 类型安全的配置访问
- ✅ **HealthModule**（健康检查）- v0.2.1 完成
  - ✅ `/health` 端点（存活探针）
  - ✅ `/ready` 端点（就绪探针）
  - ✅ 自定义健康检查器
- ✅ **MetricsModule**（指标监控）- v0.3.0 完成
  - ✅ Prometheus 格式指标导出
  - ✅ HTTP 请求指标自动收集（延迟、状态码）
  - ✅ 自定义指标支持
  - ✅ `/metrics` 端点
- ✅ **LoggerModule**（日志）
- ✅ **SecurityModule**（安全认证）

#### 速率限制 (100%)

- ✅ 速率限制中间件 - v0.3.0 完成
  - ✅ 基于 IP 的限流
  - ✅ 基于 Token/User 的限流
  - ✅ 滑动窗口算法
  - ✅ 内存存储实现
  - ✅ `@RateLimit()` 装饰器支持

#### 扩展系统 (100%)

- ✅ ApplicationExtension 应用扩展
- ✅ LoggerExtension 日志扩展
- ✅ Module 模块系统
- ✅ 自定义装饰器支持

#### 测试框架 (95%)

- ✅ 单元测试（核心模块）
- ✅ 集成测试
- ✅ 压力测试（StressTester）
- ✅ 性能基准测试（PerformanceHarness）
- ✅ Security 模块完整测试覆盖
- ✅ Swagger 模块完整测试覆盖
- ✅ ConfigModule 测试覆盖
- ✅ HealthModule 测试覆盖
- ✅ MetricsModule 测试覆盖
- ✅ RateLimit 中间件测试覆盖
- ⚠️ 整体测试覆盖率目标：85%+（进行中）

#### 文档 (90%)

- ✅ API 文档（中文/英文）
- ✅ 使用指南（中文/英文）
- ✅ 扩展系统文档
- ✅ 最佳实践文档
- ✅ 示例代码（basic-app, full-app, multi-module-app, auth-app,
  metrics-rate-limit-app）
- ⚠️ 迁移指南需要更新
- ⚠️ 故障排查指南需要完善

---

## 🚀 v1.0.0 Roadmap

### Phase 1: 数据库集成 (v0.4.0) ✅ 大部分已完成

**目标**：提供完整的数据库集成能力，这是企业级应用的核心需求

**状态**：✅ 核心功能已完成，剩余部分待完善

#### 1.1 数据库连接管理（DatabaseModule）✅ 已完成

- [x] 实现 DatabaseModule
  - [x] 连接池管理（基于 `bun:sqlite`、`postgres`、`mysql2`）
  - [x] 多数据库支持（PostgreSQL, MySQL, SQLite）
  - [x] 连接健康检查
  - [x] 连接重试机制
  - [x] 连接池配置（最大连接数、超时时间等）
- [x] 集成到 HealthModule（数据库连接健康检查）
- [x] 提供示例和文档（`examples/database-app.ts`）

**优先级**：🔴 高\
**完成状态**：✅ 已完成

#### 1.2 ORM 集成（Drizzle ORM）✅ 核心功能已完成

- [x] 选择并集成 ORM（Drizzle）
  - [x] Drizzle ORM 集成
  - [x] 装饰器支持（@Entity, @Column, @PrimaryKey）
  - [x] Repository 模式支持（BaseRepository, DrizzleBaseRepository）
  - [x] 查询构建器集成
  - [ ] 关系映射支持（@OneToMany, @ManyToOne, @ManyToMany）- **待实现**
- [x] 集成到 DI 容器（自动注入 Repository）
- [x] 提供示例和文档（`examples/database-app.ts`）

**优先级**：🔴 高\
**完成状态**：✅ 核心功能已完成，关系映射待实现

#### 1.3 事务支持 ✅ 已完成

- [x] 实现事务装饰器 `@Transactional()`
  - [x] 基本事务支持
  - [x] 嵌套事务支持（保存点）
  - [x] 事务传播行为配置（REQUIRED, REQUIRES_NEW, SUPPORTS, NOT_SUPPORTED,
        NEVER, NESTED）
  - [x] 事务隔离级别配置（READ_UNCOMMITTED, READ_COMMITTED, REPEATABLE_READ,
        SERIALIZABLE）
  - [x] 回滚策略配置（rollbackFor, noRollbackFor）
- [x] 集成到 DatabaseModule
- [x] 提供示例和文档

**优先级**：🟡 中\
**完成状态**：✅ 已完成

---

### Phase 2: 稳定性与生产就绪 (v0.5.0)

**目标**：提高框架稳定性和可靠性，确保生产环境可用

#### 2.1 测试覆盖率提升 ⚠️ 部分完成

- [ ] 提高整体测试覆盖率至 85%+
  - [x] DatabaseModule 测试覆盖 ✅（`tests/database/database-module.test.ts`）
  - [x] ORM 集成测试覆盖 ✅（`tests/database/orm.test.ts`）
  - [ ] MigrationModule 测试覆盖（MigrationModule 尚未实现）
  - [x] 事务支持测试覆盖 ✅（`tests/database/transaction.test.ts`）
  - [ ] 补充核心模块边界测试
  - [ ] PostgreSQL/MySQL 数据库集成测试（当前只有 SQLite 测试）
- [ ] 添加端到端测试（E2E）
- [ ] 添加性能回归测试

**优先级**：🔴 高\
**完成状态**：⚠️ 基础测试已完成，需要补充多数据库测试和 E2E 测试

#### 2.2 错误处理增强 ✅ 已完成

- [x] 完善错误码系统
  - [x] 统一错误码规范
  - [x] 错误码文档（`docs/error-handling.md`）
  - [x] 添加错误码系统
  - [x] 扩展错误码（数据库、文件、中间件、配置等）
- [x] 改进错误消息国际化
  - [x] 支持多语言错误消息（en, zh-CN, ja, ko）
  - [x] 错误消息模板系统（支持参数化消息）
  - [x] 改进语言检测机制（Accept-Language 头解析）
- [x] 完善异常过滤器文档（`docs/error-handling.md`）
- [x] 添加错误处理最佳实践（`docs/error-handling.md`）
- [x] 添加错误处理测试（`tests/error/error-handling.test.ts`）

**优先级**：🟡 中\
**完成状态**：✅ 已完成

#### 2.3 性能优化

- [ ] 路由匹配性能优化
- [ ] 中间件管道性能优化
- [ ] DI 容器性能优化
- [ ] 内存使用优化
- [ ] 添加性能基准测试

**优先级**：🟡 中

#### 2.4 文档完善

- [ ] 添加故障排查指南
- [ ] 完善 API 文档示例
- [ ] 添加生产部署指南
- [ ] 添加性能调优指南

**优先级**：🟡 中

---

### Phase 3: 开发者体验提升 (v0.6.0)

**目标**：提供更好的开发体验和工具支持

#### 3.1 开发工具

- [ ] TypeScript 类型增强
  - [ ] 更好的类型推断
  - [ ] 类型安全的路由定义
- [ ] 开发模式增强
  - [ ] 热重载支持
  - [ ] 开发模式错误提示
  - [ ] 调试工具集成

**优先级**：🟢 低

---

### Phase 4: 可选功能（v1.0.0 后）

**目标**：可选的高级功能和工具，根据需求决定是否实现

#### 4.1 数据库迁移工具（MigrationModule）

- [ ] 实现 MigrationModule
  - [ ] 迁移文件管理（从 v0.3.0 Phase 3.3 迁移）
  - [ ] 迁移 CLI 工具（`bun-server migrate`）
  - [ ] 版本控制（从 v0.3.0 Phase 3.3 迁移）
  - [ ] 回滚支持（从 v0.3.0 Phase 3.3 迁移）
  - [ ] 迁移状态跟踪
- [ ] 集成到 DatabaseModule
- [ ] 提供示例和文档

**优先级**：可有可无

**预计版本**：v1.1.0

#### 4.2 CLI 工具

- [ ] 项目脚手架（`bun-server new`）（从 v0.3.0 Phase 4.4 迁移）
  - [ ] 创建新项目模板（从 v0.3.0 Phase 4.4 迁移）
  - [ ] 选择模块（Config, Health, Metrics, Database, etc.）
  - [ ] 生成基础项目结构
- [ ] 代码生成器（`bun-server generate`）（从 v0.3.0 Phase 4.4 迁移）
  - [ ] Controller 生成（`bun-server generate controller UserController`）（从
        v0.3.0 Phase 4.4 迁移）
  - [ ] Service 生成（`bun-server generate service UserService`）（从 v0.3.0
        Phase 4.4 迁移）
  - [ ] Module 生成（`bun-server generate module UserModule`）（从 v0.3.0 Phase
        4.4 迁移）
  - [ ] Entity 生成（`bun-server generate entity User`）
- [ ] 数据库迁移 CLI（`bun-server migrate`）（从 v0.3.0 Phase 4.4 迁移）
  - [ ] 创建迁移文件
  - [ ] 运行迁移
  - [ ] 回滚迁移
  - [ ] 查看迁移状态

**优先级**：可有可无

**预计版本**：v1.2.0

---

### Phase 5: 高级功能（v1.0.0 后）

**目标**：为 v1.0.0 后的版本规划高级功能

#### 5.1 缓存系统（CacheModule）

- [ ] 实现缓存抽象接口（从 v0.3.0 Phase 4.1 迁移）
- [ ] 内存缓存实现（从 v0.3.0 Phase 4.1 迁移）
- [ ] Redis 缓存实现（从 v0.3.0 Phase 4.1 迁移）
- [ ] 装饰器支持：`@Cacheable()`, `@CacheEvict()`, `@CachePut()`（从 v0.3.0
      Phase 4.1 迁移）

**优先级**：🟢 低

**预计版本**：v1.3.0

#### 5.2 任务队列（QueueModule）

- [ ] 实现任务队列抽象
- [ ] 内存队列实现
- [ ] BullMQ 集成
- [ ] 定时任务支持（Cron）
- [ ] 装饰器支持：`@Queue()`, `@Cron()`
- [ ] 异步任务处理（从 v0.3.0 缺失能力迁移）

**优先级**：🟢 低

**预计版本**：v1.4.0

#### 5.3 Session 管理（SessionModule）

- [ ] 实现 Session 存储抽象（从 v0.3.0 Phase 4.3 迁移）
- [ ] 内存 Session 实现（从 v0.3.0 Phase 4.3 迁移）
- [ ] Redis Session 实现（从 v0.3.0 Phase 4.3 迁移）
- [ ] Session 中间件（从 v0.3.0 Phase 4.3 迁移）
- [ ] 装饰器支持：`@Session()`

**优先级**：🟢 低

**预计版本**：v1.5.0

#### 5.4 GraphQL 支持

- [ ] GraphQL 服务器集成
- [ ] Schema 定义
- [ ] Resolver 装饰器
- [ ] GraphQL Playground 集成

**优先级**：🟢 低

**预计版本**：v1.6.0

#### 5.5 RateLimit Redis 后端支持

- [ ] Redis 后端支持（从 v0.3.0 RateLimit 迁移）
- [ ] Redis 存储实现（RedisRateLimitStore）

**优先级**：可有可无

**预计版本**：v1.7.0

#### 5.6 国际化（i18n）

- [ ] 实现 i18n 模块（从 v0.3.0 Phase 4.5 迁移）
- [ ] 消息本地化（从 v0.3.0 Phase 4.5 迁移）
- [ ] 日期/数字格式化（从 v0.3.0 Phase 4.5 迁移）
- [ ] 装饰器支持：`@I18n()`（从 v0.3.0 Phase 4.5 迁移）

**优先级**：可有可无

**预计版本**：v1.8.0

#### 5.7 模板引擎

- [ ] 服务端渲染支持
- [ ] 模板引擎集成（如 EJS, Handlebars）
- [ ] 模板渲染装饰器支持

**优先级**：可有可无

**预计版本**：v1.9.0

#### 5.8 部署工具

- [ ] Docker 镜像构建
- [ ] 部署脚本
- [ ] 环境配置管理

**优先级**：可有可无

**预计版本**：v1.10.0

---

## 📈 v1.0.0 优先级总结

### 🔴 高优先级（v1.0.0 必须实现）

1. **数据库集成 / ORM** - 企业级应用必需
   - DatabaseModule（连接管理）
   - Drizzle ORM 集成
2. **测试覆盖率提升** - 稳定性基础
   - 整体测试覆盖率 85%+
   - 端到端测试
3. **文档完善** - 生产就绪
   - 故障排查指南
   - 生产部署指南

### 🟡 中优先级（v1.0.0 重要功能）

1. **事务支持** - 数据库核心功能
2. **错误处理增强** - 稳定性
3. **性能优化** - 生产性能

### 🟢 低优先级（v1.0.0 后实现）

1. **开发工具** - TypeScript 类型增强、热重载等
2. **缓存系统** - 性能优化（v1.3.0）
3. **任务队列** - 后台处理（v1.4.0）
4. **Session 管理** - 特定场景需要（v1.5.0）
5. **GraphQL 支持** - API 扩展（v1.6.0）
6. **RateLimit Redis 后端** - 分布式限流（v1.7.0）

### ⚪ 可有可无（根据需求决定）

1. **数据库迁移工具** - 数据库管理（v1.1.0）
2. **CLI 工具** - 项目脚手架、代码生成器（v1.2.0）
3. **国际化** - 多语言支持（v1.8.0）
4. **模板引擎** - SSR 支持（v1.9.0）
5. **部署工具** - 部署自动化（v1.10.0）

---

## 🎯 v1.0.0 发布标准

### 功能完整性

- [x] 核心框架功能完整
- [x] 官方模块完整（Config, Health, Metrics, Security, Swagger, Logger）
- [x] 数据库集成核心功能完整（Database ✅, ORM ✅, Transaction ✅）
  - [x] DatabaseModule（连接管理、连接池、健康检查）
  - [x] ORM 集成（Drizzle、装饰器、Repository）
  - [x] 事务支持（@Transactional、传播行为、隔离级别）
  - [ ] 关系映射（@OneToMany, @ManyToOne, @ManyToMany）- 待实现

### 稳定性

- [ ] 整体测试覆盖率 ≥ 85%
- [ ] 所有核心功能有完整测试
- [ ] 通过性能回归测试
- [ ] 无已知严重 Bug

### 文档

- [ ] API 文档完整
- [ ] 使用指南完整
- [ ] 迁移指南完整
- [ ] 故障排查指南完整
- [ ] 生产部署指南完整

### 向后兼容性

- [ ] API 向后兼容
- [ ] 迁移指南清晰
- [ ] 破坏性变更文档化

---

## 📝 注意事项

1. **保持向后兼容**：v1.0.0 之前的所有 API 都应该向后兼容，避免破坏性变更
2. **性能优先**：新功能不应显著影响框架性能
3. **文档同步**：每个新功能都应该有完整的文档和示例
4. **测试驱动**：新功能应该先写测试，再实现
5. **社区反馈**：关注 GitHub Issues 和 Discussions，优先实现社区需求
6. **版本规划**：v1.0.0 是稳定版本，后续版本应该遵循语义化版本规范

---

## 🔗 相关资源

- [v0.3.0 Roadmap](./v0.3.0.md)
- [API 文档](../docs/api.md)
- [使用指南](../docs/guide.md)
- [扩展系统文档](../docs/extensions.md)
- [最佳实践](../docs/best-practices.md)
- [Changelog](../.changelog/CHANGELOG_v0.3.0.md)
