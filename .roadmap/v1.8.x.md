# Bun Server Framework - v1.8.x Roadmap

> ç›®æ ‡ç‰ˆæœ¬ï¼šv1.8.0 - v1.8.x\
> é‡ç‚¹ï¼šæ¡†æ¶æ ¸å¿ƒèƒ½åŠ›å¢å¼ºï¼Œå®Œå–„ä¼ä¸šçº§ç‰¹æ€§\
> **çŠ¶æ€**ï¼šğŸ“ è§„åˆ’ä¸­

---

## ğŸ¯ v1.8.x ç‰ˆæœ¬ç›®æ ‡

v1.8.x ç‰ˆæœ¬ä¸“æ³¨äºæ¡†æ¶æ ¸å¿ƒèƒ½åŠ›å¢å¼ºï¼Œæå‡æ¡†æ¶çš„ä¼ä¸šçº§åº”ç”¨èƒ½åŠ›ã€‚ä¸»è¦ç›®æ ‡åŒ…æ‹¬ï¼š

1. **æ¶æ„æ–‡æ¡£å®Œå–„**ï¼šæ¢³ç†æœ€æ–°æ¶æ„å›¾å’Œè¯·æ±‚ç”Ÿå‘½å‘¨æœŸ
2. **Guards å®ˆå«ç³»ç»Ÿ**ï¼šå®ç° `@UseGuards()` è£…é¥°å™¨ï¼Œæ”¯æŒè®¤è¯æˆæƒå®ˆå«
3. **éªŒè¯ç³»ç»Ÿå¢å¼º**ï¼šæ”¯æŒå¯¹è±¡ã€æ•°ç»„éªŒè¯å’Œè‡ªå®šä¹‰éªŒè¯å™¨
4. **å…¨å±€æ¨¡å—æ”¯æŒ**ï¼šå®ç° `@Global()` è£…é¥°å™¨
5. **äº‹ä»¶ç³»ç»Ÿ**ï¼šå®ç° EventEmitter æ¨¡å—

---

## ğŸ“Š å½“å‰æ¡†æ¶æ¶æ„æ¦‚è§ˆ

### è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ

```
HTTP Request
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Middleware Pipeline         â”‚  â† å…¨å±€ â†’ æ¨¡å— â†’ æ§åˆ¶å™¨ â†’ æ–¹æ³•
â”‚  (Logger, CORS, RateLimit, etc.)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Security Filter             â”‚  â† è®¤è¯/æˆæƒæ£€æŸ¥
â”‚   (JWT, OAuth2, Role Check)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Router Matching             â”‚  â† è·¯ç”±åŒ¹é…
â”‚   (Path, Method, Params)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Interceptors (Pre)            â”‚  â† å…¨å±€ â†’ æ§åˆ¶å™¨ â†’ æ–¹æ³•
â”‚   (Cache, Log, Permission)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Parameter Binding             â”‚  â† @Body, @Query, @Param, @Header
â”‚       + Validation                  â”‚  â† @Validate, IsString, IsEmail...
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Controller Method             â”‚  â† ä¸šåŠ¡é€»è¾‘æ‰§è¡Œ
â”‚   (with DI injected services)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Interceptors (Post)           â”‚  â† æ–¹æ³• â†’ æ§åˆ¶å™¨ â†’ å…¨å±€
â”‚   (Response Transform)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Exception Filter              â”‚  â† å¼‚å¸¸æ•è·å’Œå¤„ç†
â”‚   (HttpException, ValidationError)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
HTTP Response
```

### æ¨¡å—ç³»ç»Ÿæ¶æ„

```
Application
    â”‚
    â”œâ”€â”€ ModuleRegistry
    â”‚   â”‚
    â”‚   â”œâ”€â”€ ConfigModule (é…ç½®ç®¡ç†)
    â”‚   â”œâ”€â”€ LoggerModule (æ—¥å¿—)
    â”‚   â”œâ”€â”€ SecurityModule (å®‰å…¨è®¤è¯)
    â”‚   â”‚   â””â”€â”€ auth/ (JWT, OAuth2)
    â”‚   â”œâ”€â”€ SwaggerModule (API æ–‡æ¡£)
    â”‚   â”œâ”€â”€ CacheModule (ç¼“å­˜)
    â”‚   â”œâ”€â”€ DatabaseModule (æ•°æ®åº“)
    â”‚   â”‚   â””â”€â”€ ORM (Entity, Repository, Transaction)
    â”‚   â”œâ”€â”€ QueueModule (é˜Ÿåˆ—)
    â”‚   â”œâ”€â”€ SessionModule (ä¼šè¯)
    â”‚   â”œâ”€â”€ MetricsModule (æŒ‡æ ‡)
    â”‚   â”œâ”€â”€ HealthModule (å¥åº·æ£€æŸ¥)
    â”‚   â””â”€â”€ Microservice/ (å¾®æœåŠ¡)
    â”‚       â”œâ”€â”€ ConfigCenterModule
    â”‚       â”œâ”€â”€ ServiceRegistryModule
    â”‚       â”œâ”€â”€ ServiceClient
    â”‚       â”œâ”€â”€ Governance (ç†”æ–­/é™æµ/é‡è¯•)
    â”‚       â””â”€â”€ Tracing (é“¾è·¯è¿½è¸ª)
    â”‚
    â”œâ”€â”€ ControllerRegistry
    â”‚   â””â”€â”€ æ‰€æœ‰æ¨¡å—çš„æ§åˆ¶å™¨
    â”‚
    â”œâ”€â”€ WebSocketGatewayRegistry
    â”‚   â””â”€â”€ WebSocket ç½‘å…³
    â”‚
    â””â”€â”€ InterceptorRegistry
        â””â”€â”€ æ‹¦æˆªå™¨æ³¨å†Œè¡¨
```

### DI å®¹å™¨æ¶æ„

```
Container
    â”‚
    â”œâ”€â”€ providers (Map<token, ProviderConfig>)
    â”‚   â”œâ”€â”€ Singleton (å•ä¾‹ï¼Œå…¨å±€å…±äº«)
    â”‚   â”œâ”€â”€ Transient (ç¬æ€ï¼Œæ¯æ¬¡è§£æåˆ›å»ºæ–°å®ä¾‹)
    â”‚   â””â”€â”€ Scoped (è¯·æ±‚ä½œç”¨åŸŸï¼Œæ¯ä¸ªè¯·æ±‚ç‹¬ç«‹)
    â”‚
    â”œâ”€â”€ singletons (ç¼“å­˜å•ä¾‹å®ä¾‹)
    â”‚
    â”œâ”€â”€ scopedInstances (WeakMapï¼Œè¯·æ±‚çº§å®ä¾‹ç¼“å­˜)
    â”‚
    â”œâ”€â”€ dependencyPlans (ä¾èµ–è§£æè®¡åˆ’ç¼“å­˜)
    â”‚
    â””â”€â”€ postProcessors (å®ä¾‹åå¤„ç†å™¨)
```

---

## ğŸš€ v1.8.x Roadmap

### Phase 1: æ¶æ„æ–‡æ¡£ä¸ç”Ÿå‘½å‘¨æœŸå®Œå–„ (v1.8.0-alpha.1)

**ç›®æ ‡**ï¼šæ¢³ç†å½“å‰æ¡†æ¶çš„æœ€æ–°æ¶æ„å›¾å’Œè¯·æ±‚ç”Ÿå‘½å‘¨æœŸï¼Œæ›´æ–°åˆ° README

#### 1.1 æ¶æ„å›¾æ›´æ–°

- [x] **æ›´æ–° README.md æ¶æ„éƒ¨åˆ†**
  - [x] æ·»åŠ è¯¦ç»†çš„è¯·æ±‚ç”Ÿå‘½å‘¨æœŸå›¾
  - [x] æ·»åŠ æ¨¡å—ç³»ç»Ÿæ¶æ„å›¾
  - [x] æ·»åŠ  DI å®¹å™¨æ¶æ„è¯´æ˜
  - [x] æ·»åŠ æ‰§è¡Œé¡ºåºè¯´æ˜ï¼ˆä¸­é—´ä»¶ â†’ å®ˆå« â†’ æ‹¦æˆªå™¨ â†’ ç®¡é“ â†’ å¤„ç†å™¨ï¼‰

- [x] **åŒæ­¥æ›´æ–°ä¸­æ–‡æ–‡æ¡£**
  - [x] æ›´æ–° `docs/zh/guide.md`
  - [x] ç¡®ä¿ä¸­è‹±æ–‡æ–‡æ¡£ä¸€è‡´

#### 1.2 ç”Ÿå‘½å‘¨æœŸæ–‡æ¡£

- [x] **åˆ›å»ºè¯·æ±‚ç”Ÿå‘½å‘¨æœŸæ–‡æ¡£**ï¼ˆ`docs/request-lifecycle.md`ï¼‰
  - [x] è¯¦ç»†è¯´æ˜æ¯ä¸ªé˜¶æ®µçš„æ‰§è¡Œé¡ºåº
  - [x] è¯´æ˜å„ç»„ä»¶ï¼ˆä¸­é—´ä»¶ã€æ‹¦æˆªå™¨ã€è¿‡æ»¤å™¨ï¼‰çš„åŒºåˆ«
  - [x] æä¾›æœ€ä½³å®è·µå»ºè®®

**äº¤ä»˜ç‰©**ï¼š

- [x] æ›´æ–°åçš„ README.md
- [x] æ–°å¢ `docs/request-lifecycle.md`
- [x] æ–°å¢ `docs/zh/request-lifecycle.md`
- [x] æ›´æ–° `.cursor/rules/architecture-overview.mdc`

---

### Phase 2: Guards å®ˆå«ç³»ç»Ÿ (v1.8.0-alpha.2)

**ç›®æ ‡**ï¼šåœ¨ Security æ¨¡å—ä¸­æ–°å¢ `@UseGuards()` è£…é¥°å™¨ï¼Œå®ç°å®ˆå«æœºåˆ¶

#### 2.1 Guard æ¥å£å®šä¹‰

```typescript
// packages/bun-server/src/security/guards/types.ts

/**
 * å®ˆå«æ¥å£
 * å®ˆå«ç”¨äºå†³å®šè¯·æ±‚æ˜¯å¦å¯ä»¥ç»§ç»­æ‰§è¡Œ
 */
export interface CanActivate {
  /**
   * åˆ¤æ–­æ˜¯å¦å…è®¸è®¿é—®
   * @param context - æ‰§è¡Œä¸Šä¸‹æ–‡
   * @returns æ˜¯å¦å…è®¸è®¿é—®
   */
  canActivate(context: ExecutionContext): boolean | Promise<boolean>;
}

/**
 * æ‰§è¡Œä¸Šä¸‹æ–‡
 * æä¾›è¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­çš„ä¸Šä¸‹æ–‡ä¿¡æ¯
 */
export interface ExecutionContext {
  /**
   * è·å– HTTP ä¸Šä¸‹æ–‡
   */
  switchToHttp(): HttpArgumentsHost;

  /**
   * è·å– WebSocket ä¸Šä¸‹æ–‡
   */
  switchToWs(): WsArgumentsHost;

  /**
   * è·å–å½“å‰å¤„ç†çš„æ§åˆ¶å™¨ç±»
   */
  getClass(): Constructor<unknown>;

  /**
   * è·å–å½“å‰å¤„ç†çš„æ–¹æ³•
   */
  getHandler(): Function;

  /**
   * è·å–æ–¹æ³•æˆ–ç±»çš„å…ƒæ•°æ®
   */
  getMetadata<T>(key: string | symbol): T | undefined;
}

export interface HttpArgumentsHost {
  getRequest(): Context;
  getResponse(): ResponseBuilder;
}

export interface WsArgumentsHost {
  getClient(): ServerWebSocket<unknown>;
  getData(): unknown;
}
```

#### 2.2 è£…é¥°å™¨å®ç°

```typescript
// packages/bun-server/src/security/guards/decorators.ts

/**
 * å®ˆå«è£…é¥°å™¨
 * å¯ç”¨äºæ§åˆ¶å™¨æˆ–æ–¹æ³•çº§åˆ«
 */
export function UseGuards(
  ...guards: (Constructor<CanActivate> | CanActivate)[]
): ClassDecorator & MethodDecorator;
```

#### 2.3 å†…ç½®å®ˆå«

- [x] **AuthGuard**ï¼šåŸºäº `@Auth()` å…ƒæ•°æ®çš„è®¤è¯å®ˆå«
- [x] **RolesGuard**ï¼šåŸºäºè§’è‰²çš„æˆæƒå®ˆå«
- [ ] **ThrottlerGuard**ï¼šè¯·æ±‚é™æµå®ˆå«ï¼ˆä¸ RateLimit ä¸­é—´ä»¶æ•´åˆï¼‰-
      å¯é€‰ï¼Œå»¶åå®ç°

#### 2.4 å®ç°ä»»åŠ¡

- [x] å®šä¹‰ `CanActivate` æ¥å£ï¼ˆ`src/security/guards/types.ts`ï¼‰
- [x] å®šä¹‰ `ExecutionContext` æ¥å£
- [x] å®ç° `@UseGuards()` è£…é¥°å™¨ï¼ˆ`src/security/guards/decorators.ts`ï¼‰
- [x] å®ç° `GuardRegistry`ï¼ˆå®ˆå«æ³¨å†Œå’Œç®¡ç†ï¼‰
- [x] é›†æˆåˆ°è¯·æ±‚å¤„ç†æµç¨‹ï¼ˆåœ¨ä¸­é—´ä»¶ä¹‹åã€æ‹¦æˆªå™¨ä¹‹å‰æ‰§è¡Œï¼‰
- [x] å®ç°å†…ç½® `AuthGuard`
- [x] å®ç°å†…ç½® `RolesGuard`
- [x] æ·»åŠ å•å…ƒæµ‹è¯•ï¼ˆ`tests/security/guards/`ï¼‰
- [x] æ·»åŠ é›†æˆæµ‹è¯•
- [x] æ›´æ–°æ–‡æ¡£

#### 2.5 ä½¿ç”¨ç¤ºä¾‹

```typescript
// è‡ªå®šä¹‰å®ˆå«
@Injectable()
class AuthGuard implements CanActivate {
  canActivate(context: ExecutionContext): boolean {
    const request = context.switchToHttp().getRequest();
    return request.auth?.isAuthenticated ?? false;
  }
}

// è§’è‰²å®ˆå«
@Injectable()
class RolesGuard implements CanActivate {
  constructor(private reflector: Reflector) {}

  canActivate(context: ExecutionContext): boolean {
    const roles = this.reflector.get<string[]>("roles", context.getHandler());
    if (!roles) return true;

    const request = context.switchToHttp().getRequest();
    const userRoles = request.auth?.user?.roles ?? [];
    return roles.some((role) => userRoles.includes(role));
  }
}

// ä½¿ç”¨å®ˆå«
@Controller("/api/admin")
@UseGuards(AuthGuard, RolesGuard)
class AdminController {
  @GET("/dashboard")
  @Roles("admin")
  dashboard() {
    return { message: "Admin dashboard" };
  }
}
```

**äº¤ä»˜ç‰©**ï¼š

- `src/security/guards/` ç›®å½•
- `@UseGuards()` è£…é¥°å™¨
- å†…ç½® `AuthGuard`ã€`RolesGuard`
- `tests/security/guards/` æµ‹è¯•
- æ›´æ–° `src/index.ts` å¯¼å‡º

---

### Phase 3: éªŒè¯ç³»ç»Ÿå¢å¼º (v1.8.0-alpha.3) âœ…

**ç›®æ ‡**ï¼šè¡¥å…¨å¯¹è±¡ã€æ•°ç»„éªŒè¯è§„åˆ™ï¼Œæ”¯æŒè‡ªå®šä¹‰éªŒè¯å™¨

#### 3.1 æ–°å¢éªŒè¯è§„åˆ™

```typescript
// å¯¹è±¡éªŒè¯
IsObject(options?: { message?: string }): ValidationRuleDefinition
ValidateNested(options?: { each?: boolean }): ValidationRuleDefinition
IsNotEmpty(options?: { message?: string }): ValidationRuleDefinition
IsNotEmptyObject(options?: { message?: string }): ValidationRuleDefinition

// æ•°ç»„éªŒè¯
IsArray(options?: { message?: string }): ValidationRuleDefinition
ArrayMinSize(min: number, options?: { message?: string }): ValidationRuleDefinition
ArrayMaxSize(max: number, options?: { message?: string }): ValidationRuleDefinition
ArrayUnique(options?: { message?: string }): ValidationRuleDefinition
ArrayContains(values: unknown[], options?: { message?: string }): ValidationRuleDefinition

// æ¡ä»¶éªŒè¯
ValidateIf(condition: (value: unknown, obj: unknown) => boolean): ValidationRuleDefinition

// ç±»å‹è½¬æ¢ï¼ˆPipes é£æ ¼ï¼‰
Transform(transformFn: (value: unknown) => unknown): ValidationRuleDefinition

// å…¶ä»–å¸¸ç”¨è§„åˆ™
IsUUID(version?: '3' | '4' | '5' | 'all', options?: { message?: string }): ValidationRuleDefinition
IsDate(options?: { message?: string }): ValidationRuleDefinition
IsBoolean(options?: { message?: string }): ValidationRuleDefinition
IsInt(options?: { message?: string }): ValidationRuleDefinition
IsPositive(options?: { message?: string }): ValidationRuleDefinition
IsNegative(options?: { message?: string }): ValidationRuleDefinition
Min(min: number, options?: { message?: string }): ValidationRuleDefinition
Max(max: number, options?: { message?: string }): ValidationRuleDefinition
Length(min: number, max?: number, options?: { message?: string }): ValidationRuleDefinition
Matches(pattern: RegExp, options?: { message?: string }): ValidationRuleDefinition
IsIn(values: unknown[], options?: { message?: string }): ValidationRuleDefinition
IsNotIn(values: unknown[], options?: { message?: string }): ValidationRuleDefinition
```

#### 3.2 è‡ªå®šä¹‰éªŒè¯å™¨

```typescript
// è‡ªå®šä¹‰éªŒè¯å™¨å·¥å‚
function createCustomValidator(
  name: string,
  validate: (value: unknown, ...args: unknown[]) => boolean,
  defaultMessage: string,
): (...args: unknown[]) => ValidationRuleDefinition;

// ä½¿ç”¨ç¤ºä¾‹
const IsPhoneNumber = createCustomValidator(
  "isPhoneNumber",
  (value) => typeof value === "string" && /^1[3-9]\d{9}$/.test(value),
  "å¿…é¡»æ˜¯æœ‰æ•ˆçš„æ‰‹æœºå·ç ",
);

// DTO ç±»çº§åˆ«éªŒè¯
@ValidateClass()
class CreateUserDto {
  @IsString()
  @MinLength(2)
  name: string;

  @IsEmail()
  email: string;

  @IsOptional()
  @IsPhoneNumber()
  phone?: string;
}
```

#### 3.3 å®ç°ä»»åŠ¡

- [x] å®ç°å¯¹è±¡éªŒè¯è§„åˆ™ï¼ˆ`IsObject`, `ValidateNested`, `IsNotEmpty`,
      `IsNotEmptyObject`ï¼‰
- [x] å®ç°æ•°ç»„éªŒè¯è§„åˆ™ï¼ˆ`IsArray`, `ArrayMinSize`, `ArrayMaxSize`,
      `ArrayUnique`, `ArrayContains`, `ArrayNotContains`, `ArrayNotEmpty`ï¼‰
- [x] å®ç°æ¡ä»¶éªŒè¯è§„åˆ™ï¼ˆ`ValidateIf`ï¼‰
- [x] å®ç°ç±»å‹è½¬æ¢è§„åˆ™ï¼ˆ`Transform`ï¼‰
- [x] å®ç°å…¶ä»–å¸¸ç”¨è§„åˆ™ï¼ˆ`IsUUID`, `IsDate`, `IsBoolean`, `IsInt`, `Min`, `Max`,
      `Length`, `MaxLength`, `Matches`, `IsIn`, `IsNotIn`, `IsPositive`,
      `IsNegative`, `IsUrl`, `IsJSON`, `Equals`, `NotEquals`, `IsDefined`,
      `IsAlphanumeric`, `IsAlpha`, `IsNumberString`ï¼‰
- [x] å®ç°è‡ªå®šä¹‰éªŒè¯å™¨å·¥å‚ï¼ˆ`createCustomValidator`, `createSimpleValidator`,
      `createRegexValidator`ï¼‰
- [x] å®ç° DTO ç±»çº§åˆ«éªŒè¯ï¼ˆ`@ValidateClass()`, `@Property()`,
      `@NestedProperty()`, `@ArrayNestedProperty()`ï¼‰
- [x] åµŒå¥—å¯¹è±¡éªŒè¯æ”¯æŒ
- [x] æ·»åŠ å•å…ƒæµ‹è¯•ï¼ˆ`tests/validation/`ï¼‰- 129 tests, 100% pass
- [x] æ›´æ–°æ–‡æ¡£

**äº¤ä»˜ç‰©**ï¼š

- æ›´æ–° `src/validation/decorators.ts`
- æ–°å¢ `src/validation/rules/` ç›®å½•ï¼ˆæŒ‰ç±»åˆ«ç»„ç»‡ï¼‰
  - `object.ts` - å¯¹è±¡éªŒè¯è§„åˆ™
  - `array.ts` - æ•°ç»„éªŒè¯è§„åˆ™
  - `common.ts` - é€šç”¨éªŒè¯è§„åˆ™
  - `conditional.ts` - æ¡ä»¶å’Œè½¬æ¢è§„åˆ™
- æ–°å¢ `src/validation/custom-validator.ts` - è‡ªå®šä¹‰éªŒè¯å™¨å·¥å‚å’Œå†…ç½®æ‰©å±•éªŒè¯å™¨
- æ–°å¢ `src/validation/class-validator.ts` - ç±»çº§åˆ«éªŒè¯æ”¯æŒ
- `tests/validation/` æ‰©å±•æµ‹è¯•ï¼ˆ129 ä¸ªæµ‹è¯•ï¼‰
- æ›´æ–° `src/index.ts` å¯¼å‡º

---

### Phase 4: @Global() æ¨¡å—è£…é¥°å™¨ (v1.8.0-alpha.4)

**ç›®æ ‡**ï¼šå®ç° `@Global()` è£…é¥°å™¨ï¼Œä½¿æ¨¡å—çš„æä¾›è€…å¯å…¨å±€è®¿é—®

#### 4.1 è®¾è®¡è¯´æ˜

å…¨å±€æ¨¡å—çš„æä¾›è€…æ— éœ€åœ¨å…¶ä»–æ¨¡å—ä¸­å¯¼å…¥å³å¯ä½¿ç”¨ã€‚é€‚ç”¨äºï¼š

- é…ç½®æœåŠ¡ï¼ˆConfigServiceï¼‰
- æ—¥å¿—æœåŠ¡ï¼ˆLoggerï¼‰
- ç¼“å­˜æœåŠ¡ï¼ˆCacheServiceï¼‰
- å…¶ä»–å…¨å±€å…±äº«çš„æœåŠ¡

#### 4.2 æ¥å£å®šä¹‰

```typescript
// packages/bun-server/src/di/decorators.ts

/**
 * å…¨å±€æ¨¡å—è£…é¥°å™¨
 * æ ‡è®°æ¨¡å—ä¸ºå…¨å±€æ¨¡å—ï¼Œå…¶å¯¼å‡ºçš„æä¾›è€…å¯åœ¨ä»»ä½•æ¨¡å—ä¸­ä½¿ç”¨
 */
export function Global(): ClassDecorator;
```

#### 4.3 å®ç°ä»»åŠ¡

- [ ] å®ç° `@Global()` è£…é¥°å™¨ï¼ˆ`src/di/decorators.ts`ï¼‰
- [ ] ä¿®æ”¹ `ModuleRegistry` æ”¯æŒå…¨å±€æ¨¡å—
  - [ ] å…¨å±€æ¨¡å—çš„ exports è‡ªåŠ¨æ³¨å†Œåˆ°æ ¹å®¹å™¨
  - [ ] æ‰€æœ‰æ¨¡å—å¯ç›´æ¥æ³¨å…¥å…¨å±€æä¾›è€…
- [ ] ä¿®æ”¹ `Module` å…ƒæ•°æ®ç»“æ„æ”¯æŒ `isGlobal` æ ‡è®°
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•ï¼ˆ`tests/di/global-module.test.ts`ï¼‰
- [ ] æ›´æ–°æ–‡æ¡£

#### 4.4 ä½¿ç”¨ç¤ºä¾‹

```typescript
@Global()
@Module({
  providers: [
    {
      provide: CONFIG_SERVICE_TOKEN,
      useClass: ConfigService,
    },
  ],
  exports: [CONFIG_SERVICE_TOKEN],
})
class GlobalConfigModule {}

// å…¶ä»–æ¨¡å—æ— éœ€å¯¼å…¥ GlobalConfigModule å³å¯ä½¿ç”¨ ConfigService
@Module({
  controllers: [UserController],
  providers: [UserService],
  // ä¸éœ€è¦: imports: [GlobalConfigModule]
})
class UserModule {}

@Injectable()
class UserService {
  constructor(
    @Inject(CONFIG_SERVICE_TOKEN) private readonly config: ConfigService,
  ) {}
}
```

**äº¤ä»˜ç‰©**ï¼š

- `@Global()` è£…é¥°å™¨å®ç°
- æ›´æ–° `ModuleRegistry`
- `tests/di/global-module.test.ts`
- æ›´æ–°æ–‡æ¡£

---

### Phase 5: EventEmitter äº‹ä»¶ç³»ç»Ÿ (v1.8.0)

**ç›®æ ‡**ï¼šå®ç°äº‹ä»¶é©±åŠ¨æ¶æ„æ”¯æŒ

#### 5.1 æ¨¡å—è®¾è®¡

```typescript
// packages/bun-server/src/events/types.ts

/**
 * äº‹ä»¶ç›‘å¬å™¨æ¥å£
 */
export interface EventListener<T = unknown> {
  (payload: T): void | Promise<void>;
}

/**
 * äº‹ä»¶å…ƒæ•°æ®
 */
export interface EventMetadata {
  event: string | symbol;
  async?: boolean;
  priority?: number;
}

/**
 * EventEmitter æœåŠ¡æ¥å£
 */
export interface EventEmitter {
  /**
   * å‘å¸ƒäº‹ä»¶
   */
  emit<T>(event: string | symbol, payload: T): void;

  /**
   * å¼‚æ­¥å‘å¸ƒäº‹ä»¶ï¼ˆç­‰å¾…æ‰€æœ‰ç›‘å¬å™¨å®Œæˆï¼‰
   */
  emitAsync<T>(event: string | symbol, payload: T): Promise<void>;

  /**
   * è®¢é˜…äº‹ä»¶
   */
  on<T>(event: string | symbol, listener: EventListener<T>): () => void;

  /**
   * ä¸€æ¬¡æ€§è®¢é˜…
   */
  once<T>(event: string | symbol, listener: EventListener<T>): () => void;

  /**
   * å–æ¶ˆè®¢é˜…
   */
  off<T>(event: string | symbol, listener: EventListener<T>): void;

  /**
   * ç§»é™¤æ‰€æœ‰ç›‘å¬å™¨
   */
  removeAllListeners(event?: string | symbol): void;
}
```

#### 5.2 è£…é¥°å™¨å®šä¹‰

```typescript
// packages/bun-server/src/events/decorators.ts

/**
 * äº‹ä»¶ç›‘å¬å™¨è£…é¥°å™¨
 */
export function OnEvent(
  event: string | symbol,
  options?: { async?: boolean; priority?: number },
): MethodDecorator;

/**
 * äº‹ä»¶å‘å¸ƒè€…è£…é¥°å™¨ï¼ˆè‡ªåŠ¨æ³¨å…¥ EventEmitterï¼‰
 */
export function EventEmitter(): PropertyDecorator;
```

#### 5.3 EventModule

```typescript
// packages/bun-server/src/events/event-module.ts

export interface EventModuleOptions {
  /**
   * æ˜¯å¦å¯ç”¨é€šé…ç¬¦äº‹ä»¶ï¼ˆå¦‚ 'user.*'ï¼‰
   * @default false
   */
  wildcard?: boolean;

  /**
   * å…¨å±€äº‹ä»¶å‰ç¼€
   */
  globalPrefix?: string;

  /**
   * æœ€å¤§ç›‘å¬å™¨æ•°é‡ï¼ˆé˜²æ­¢å†…å­˜æ³„æ¼ï¼‰
   * @default 10
   */
  maxListeners?: number;
}

@Module({})
export class EventModule {
  static forRoot(options?: EventModuleOptions): DynamicModule;
}
```

#### 5.4 å®ç°ä»»åŠ¡

- [ ] å®šä¹‰äº‹ä»¶ç³»ç»Ÿç±»å‹ï¼ˆ`src/events/types.ts`ï¼‰
- [ ] å®ç° `EventEmitterService`ï¼ˆ`src/events/service.ts`ï¼‰
- [ ] å®ç° `@OnEvent()` è£…é¥°å™¨ï¼ˆ`src/events/decorators.ts`ï¼‰
- [ ] å®ç° `EventModule`ï¼ˆ`src/events/event-module.ts`ï¼‰
- [ ] å®ç°äº‹ä»¶ç›‘å¬å™¨è‡ªåŠ¨æ‰«æå’Œæ³¨å†Œ
- [ ] æ”¯æŒå¼‚æ­¥äº‹ä»¶å¤„ç†
- [ ] æ”¯æŒäº‹ä»¶ä¼˜å…ˆçº§
- [ ] æ”¯æŒé€šé…ç¬¦äº‹ä»¶ï¼ˆå¯é€‰ï¼‰
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•ï¼ˆ`tests/events/`ï¼‰
- [ ] æ·»åŠ é›†æˆæµ‹è¯•
- [ ] æ›´æ–°æ–‡æ¡£

#### 5.5 ä½¿ç”¨ç¤ºä¾‹

```typescript
// å®šä¹‰äº‹ä»¶
const USER_CREATED = Symbol("user.created");
const USER_UPDATED = "user.updated";

// äº‹ä»¶è´Ÿè½½ç±»å‹
interface UserCreatedEvent {
  userId: string;
  email: string;
  createdAt: Date;
}

// æœåŠ¡ä¸­å‘å¸ƒäº‹ä»¶
@Injectable()
class UserService {
  constructor(
    @Inject(EVENT_EMITTER_TOKEN) private readonly eventEmitter: EventEmitter,
  ) {}

  async createUser(data: CreateUserDto) {
    const user = await this.userRepository.create(data);

    // å‘å¸ƒäº‹ä»¶
    this.eventEmitter.emit<UserCreatedEvent>(USER_CREATED, {
      userId: user.id,
      email: user.email,
      createdAt: new Date(),
    });

    return user;
  }
}

// ç›‘å¬äº‹ä»¶
@Injectable()
class NotificationService {
  @OnEvent(USER_CREATED)
  async handleUserCreated(payload: UserCreatedEvent) {
    console.log(`New user created: ${payload.email}`);
    await this.sendWelcomeEmail(payload.email);
  }
}

@Injectable()
class AnalyticsService {
  @OnEvent(USER_CREATED, { async: true, priority: 10 })
  async trackUserCreation(payload: UserCreatedEvent) {
    await this.analytics.track("user_created", payload);
  }
}

// æ¨¡å—é…ç½®
@Module({
  imports: [
    EventModule.forRoot({
      wildcard: true,
      maxListeners: 20,
    }),
  ],
  providers: [UserService, NotificationService, AnalyticsService],
})
class AppModule {}
```

**äº¤ä»˜ç‰©**ï¼š

- `src/events/` ç›®å½•
- `EventModule`
- `@OnEvent()` è£…é¥°å™¨
- `EventEmitterService`
- `tests/events/` æµ‹è¯•
- æ›´æ–° `src/index.ts` å¯¼å‡º
- æ–‡æ¡£

---

## ğŸ“‹ éªŒæ”¶æ ‡å‡†

### Phase 1 éªŒæ”¶

- [x] README.md åŒ…å«å®Œæ•´çš„æ¶æ„å›¾å’Œç”Ÿå‘½å‘¨æœŸè¯´æ˜
- [x] ä¸­è‹±æ–‡æ–‡æ¡£åŒæ­¥æ›´æ–°
- [x] `.cursor/rules/architecture-overview.mdc` æ›´æ–°

### Phase 2 éªŒæ”¶

- [x] `@UseGuards()` è£…é¥°å™¨å¯ç”¨äºæ§åˆ¶å™¨å’Œæ–¹æ³•çº§åˆ«
- [x] Guards åœ¨ä¸­é—´ä»¶ä¹‹åã€æ‹¦æˆªå™¨ä¹‹å‰æ‰§è¡Œ
- [x] `AuthGuard` å’Œ `RolesGuard` å†…ç½®å®ˆå«å¯ç”¨
- [x] æµ‹è¯•è¦†ç›–ç‡ > 90%ï¼ˆ98 tests, 100% passï¼‰
- [x] æ–‡æ¡£æ›´æ–°
  - [x] `docs/guards.md` å®ˆå«ä½¿ç”¨æŒ‡å—
  - [x] `docs/zh/guards.md` ä¸­æ–‡æ–‡æ¡£åŒæ­¥
  - [x] æ›´æ–° `docs/guide.md` æ·»åŠ å®ˆå«ç« èŠ‚
- [x] ç¤ºä¾‹ä»£ç 
  - [x] `examples/02-official-modules/guards-app.ts` å®ˆå«ç¤ºä¾‹

### Phase 3 éªŒæ”¶

- [x] å¯¹è±¡éªŒè¯ï¼ˆ`IsObject`, `ValidateNested`ï¼‰æ­£å¸¸å·¥ä½œ
- [x] æ•°ç»„éªŒè¯ï¼ˆ`IsArray`, `ArrayMinSize`ï¼‰æ­£å¸¸å·¥ä½œ
- [x] è‡ªå®šä¹‰éªŒè¯å™¨å·¥å‚å¯ç”¨
- [x] åµŒå¥—å¯¹è±¡éªŒè¯æ”¯æŒ
- [x] æµ‹è¯•è¦†ç›–ç‡ > 90%ï¼ˆ129 tests, 100% passï¼‰
- [x] æ–‡æ¡£æ›´æ–°
  - [x] `docs/validation.md` éªŒè¯ä½¿ç”¨æŒ‡å—
  - [x] `docs/zh/validation.md` ä¸­æ–‡æ–‡æ¡£åŒæ­¥
  - [ ] æ›´æ–° `docs/guide.md` æ·»åŠ é«˜çº§éªŒè¯ç« èŠ‚ï¼ˆå¯é€‰ï¼Œå·²æœ‰ç‹¬ç«‹æ–‡æ¡£ï¼‰
- [x] ç¤ºä¾‹ä»£ç 
  - [x] `examples/02-official-modules/validation-app.ts`
        éªŒè¯ç¤ºä¾‹ï¼ˆåŒ…å«å¯¹è±¡ã€æ•°ç»„ã€è‡ªå®šä¹‰éªŒè¯å™¨ï¼‰

### Phase 4 éªŒæ”¶

- [ ] `@Global()` è£…é¥°å™¨å¯ç”¨
- [ ] å…¨å±€æ¨¡å—çš„ exports å¯åœ¨ä»»ä½•æ¨¡å—ä¸­ä½¿ç”¨
- [ ] ä¸å½±å“ç°æœ‰éå…¨å±€æ¨¡å—è¡Œä¸º
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 90%
- [ ] æ–‡æ¡£æ›´æ–°
  - [ ] æ›´æ–° `docs/guide.md` æ·»åŠ å…¨å±€æ¨¡å—ç« èŠ‚
  - [ ] æ›´æ–° `docs/zh/guide.md` ä¸­æ–‡æ–‡æ¡£åŒæ­¥
- [ ] ç¤ºä¾‹ä»£ç 
  - [ ] `examples/01-basic/global-module-app.ts` å…¨å±€æ¨¡å—ç¤ºä¾‹

### Phase 5 éªŒæ”¶

- [ ] `EventModule` å¯æ­£å¸¸æ³¨å†Œå’Œä½¿ç”¨
- [ ] `@OnEvent()` è£…é¥°å™¨è‡ªåŠ¨æ³¨å†Œç›‘å¬å™¨
- [ ] åŒæ­¥/å¼‚æ­¥äº‹ä»¶å‘å¸ƒæ­£å¸¸å·¥ä½œ
- [ ] äº‹ä»¶ä¼˜å…ˆçº§æ­£ç¡®æ‰§è¡Œ
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 90%
- [ ] æ–‡æ¡£æ›´æ–°
  - [ ] `docs/events.md` äº‹ä»¶ç³»ç»Ÿä½¿ç”¨æŒ‡å—
  - [ ] `docs/zh/events.md` ä¸­æ–‡æ–‡æ¡£åŒæ­¥
  - [ ] æ›´æ–° `docs/guide.md` æ·»åŠ äº‹ä»¶ç³»ç»Ÿç« èŠ‚
- [ ] ç¤ºä¾‹ä»£ç 
  - [ ] `examples/02-official-modules/events-app.ts` äº‹ä»¶ç³»ç»Ÿç¤ºä¾‹

---

## ğŸ”— ç›¸å…³èµ„æº

- [v1.4.x Roadmap](./v1.4.x.md) - å¾®æœåŠ¡æ¶æ„æ”¯æŒ
- [v1.x.x æ±‡æ€»æ¸…å•](./v1.x.x.md) - æ‰€æœ‰å¾…å®ç°åŠŸèƒ½ç‰¹æ€§æ±‡æ€»
- [æ¶æ„æ¦‚è§ˆ](./.cursor/rules/architecture-overview.mdc) - é¡¹ç›®æ¶æ„è§„èŒƒ

---

## ğŸ“ æ›´æ–°æ—¥å¿—

| æ—¥æœŸ       | ç‰ˆæœ¬         | æ›´æ–°å†…å®¹                  |
| ---------- | ------------ | ------------------------- |
| 2026-01-21 | v1.8.0-draft | åˆå§‹è§„åˆ’ï¼Œå®šä¹‰ 5 ä¸ª Phase |
