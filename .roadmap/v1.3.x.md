# Bun Server Framework - v1.3.x Roadmap

> 目标：微服务 & 扩展性增强（预规划阶段）

## 新增特性提案：QueryMap 注解能力

### 背景

- 现状：`@Query()` 仅支持读取单个 query 参数；业务常需一次性获取全部 query
  或将其映射为 DTO。
- 问题：需手动从 `Context` 取 `getQueryAll()`，易重复且缺少类型约束/验证入口。

### 目标

- 提供 `@QueryMap()`（或等价装饰器），在控制器方法参数处注入完整查询对象。
- 支持聚合、转换、可选校验，与现有 `ParamBinder` 无缝协同，不破坏 `@Query()`
  现有用法。

### 设计要点

- 返回形态：默认 `Record<string, string | string[]>`，重复 key 自动聚合为数组。
- 兼容装饰器参数：允许传入转换/校验选项（如
  `{ transform?: (input) => T; validate?: (dto) => void }`）。
- ParamBinder 集成：新增 `ParamType.QUERY_MAP` 分支；与 `@Query()`
  并行，不互斥。
- DTO/验证预留：可与现有验证装饰器组合，或在装饰器选项内调用验证逻辑。
- 类型定义：为 `QueryMapOptions`、返回类型定义（可泛型 `@QueryMap<T>()`）。

### 交付里程碑（v1.3.x 内）

- [ ] 装饰器实现：`@QueryMap()` + `ParamType.QUERY_MAP`
- [ ] ParamBinder 支持：聚合 query → 对象，支持数组化
- [ ] 选项/类型：`QueryMapOptions`（transform/validate 可选）
- [ ] 导出：`src/controller` 及根入口统一导出
- [ ] 文档与示例：在示例或 README 中演示 `@QueryMap()` + DTO/验证用法
- [ ] 测试：单元测试（ParamBinder
      聚合/数组化/transform/validate）；控制器集成测试

### 验收标准

- 控制器方法可通过 `@QueryMap()` 一次注入完整 query 对象，重复 key
  正常聚合为数组。
- 可选传入 transform/validate 逻辑并在绑定阶段生效（验证失败抛出对应异常）。
- 不影响现有 `@Query()`、`@Body()` 等参数绑定行为；全量测试通过。
